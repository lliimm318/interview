# 2장 아키텍처 개요

## 네 개의 영약
표현(UI), 응용, 도메인, 인프라스트럭처

**표현, 응용, 도메인 영역은 구현 기술을 직접 만들지 않고, 인프라스트럭처에서 제공하는 기능을 사용해서 필요한 기능을 개발한다.**

#### 표현
http 요청을 응용 영역이 필요로 하는 형식으로 변환 하거나
응용 영역의 응답을 http로 변환하여 전송

1. 웹 브라우저 http 요청 파라미터 -> 응용이 요구하는 객체 타입으로 변환
2. 응용 서비스가 리턴 -> json으로 변환해서 http 응답으로 웹 브라우저에게 전달

#### 응용
응용 서비스는 로직을 직접 수행하지 않고 도메인 모델에 수행을 위임
- ex) 주문 취소 시 order.cancel() 이렇게 !

#### 도메인
도메인 모델을 구현
- 도메인 핵심 로직 (결제, 주문 취소 등등)

#### 인프라
RDBMS 연동, 메시징 큐 메세지 전달 / 수신 등등 구현 기술에 대한 것을 다룸

## 계층 구조 아키텍처

- 표현 > 응용 > 도메인 > 인프라스트럭처

상위 계층에서 하위 계층으로 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않음 
(ex. 표현은 응용에 의존하지만, 응용은 표현에 의존하지 않음)

엄격하게 하면 바로 아래 계층에만 의존해야 하지만 외부 시스템과 연동을 위해 더 아래 계층인 인프라스트럭처와 의존하기도 한다.
- 도메인(엔티티)과 응용(서비스) 영역은 DB나 외부 시스템 연동을 위해 인프라에 의존

-> **표현, 응용, 도메인이 상세한 구현기술을 가지는 인프라스트럭처에 의존** 

인프라스트럭처에 의존하면 테스트 어려움 및 기능 확장의 어려움 !!!

## DIP
- 고수준의 모듈 : 의미 있는 단일 기능 (ex. 주문 계산)
- 저수준의 모듈 : JPA 처럼 주문 계산을 직접 구현한 것

고수준이 정상 동작하려면 저수준 모듈을 사용해야 한다. 고수준이 저수준을 사용하면 위에서 나온 변경과 테스트가 어렵다는 문제가 생긴다 !!

-> 저수준이 고수준에 의존하도록 ! 의존역전

고수준 모듈은 더이상 저수준에 의존하지 않고 구현을 추상화한 인터페이스에 의존한다. 
구현 기술을 변경해도 사용할 저수준 구현 객체를 생성하는 부분만 변경하면 된다.

## 도메인 영역의 주요 구성
- 엔티티 : 고유 식별자 갖음. 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능 제공
- 밸류 : 고유 식별자 X. 개념적인 하나의 값. 엔테테의 속성이나 다른 밸류 타입의 속성
- 애그리거트 : 연관된 엔티티 밸류 객체를 개념적으로 하나로 묶은 것
- 리포지토리 : 도메인 모델의 영속성 처리
- 도메인 서비스 : 특정 엔티티에 속하지 않은 도메인 로직. (ex. 할인 금액 계산은 상품, 쿠폰, 회원 등급, 구매금 등 다양한 조건을 이용해서 구현하는데 도메인 로직이 여러 엔티티와 밸류를 필요로하면 도메인 서비스에서 로직 구현)

### 도메인 엔티티 DB 엔티티
둘은 다른 거임 !

**도메인 모델의 엔티티는 데이터와 함께 도메인 기능을 제공**
1. 도메인 모델의 엔티티는 단순히 데이터를 담는 것이 아닌 데이터와 함께 기능을 제공
2. 도메인 모델의 엔티티는 두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입으로 표현 (주문자를 orderer 이렇게! orderer 안에는 이름 전화번호가 있고)
   - RDBMS는 밸류를 제대로 표현허기 힘들다
  
### 애그리거트

